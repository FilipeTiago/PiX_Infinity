#!/bin/bash
set -euo pipefail
cmd="${1:-}"; shift || true
ARG="${1:-}"

[[ -z "${XDG_VTNR:-}" ]] && { echo "kioskES: run from local console/ES"; exit 1; }

VT_CHROME="${KIOSK_VT_CHROME:-8}"
VT_GALLERY="${KIOSK_VT_GALLERY:-9}"
VT_VIDEO="${KIOSK_VT_VIDEO:-10}"
VT_IPTV="${KIOSK_VT_IPTV:-11}"
VT_MUSIC="${KIOSK_VT_MUSIC:-12}"
VT_RADIO="${KIOSK_VT_RADIO:-13}"

chrome()  { sudo -n /usr/local/sbin/kiosk-vt-launch "$VT_CHROME"  /usr/local/bin/chromiumctl start "${ARG}"; }
gallery() { sudo -n /usr/local/sbin/kiosk-vt-launch "$VT_GALLERY" /usr/local/bin/galleryctl  start "${ARG}"; }
video()   { sudo -n /usr/local/sbin/kiosk-vt-launch "$VT_VIDEO"   /usr/local/bin/videoctl    start "${ARG}"; }
iptv()    { sudo -n /usr/local/sbin/kiosk-vt-launch "$VT_IPTV"    /usr/local/bin/iptvctl     start "${ARG}"; }
music()   { sudo -n /usr/local/sbin/kiosk-vt-launch "$VT_MUSIC"   /usr/local/bin/musicctl    start "${ARG}"; }
radio()   { sudo -n /usr/local/sbin/kiosk-vt-launch "$VT_RADIO"   /usr/local/bin/radioctl    start "${ARG}"; }

case "$cmd" in
  -chrome)   chrome   ;;
  -gallery)  gallery  ;;
  -video)    video    ;;
  -iptv)     iptv     ;;
  -music) music ;;
  -radio) radio ;;
  -screensaver) echo "screensaver has its own VT service (VT7)"; exit 0 ;;
  *) echo "usage: kioskES {-chrome|-gallery|-video|-iptv} {PATH|URL}"; exit 2 ;;
esac
